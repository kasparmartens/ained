function vali_oppekava(e){d3.select("#seosed").remove(),d3.select("#oppeained").remove(),d3.select("#skeem").append("svg").attr("id","skeemi_ID").attr("width",10).attr("height",10).append("g").attr("transform","translate("+(radius+margin.left)+","+(radius+margin.top)+")"),"intro"==e?(d3.select("svg").attr("width",0).attr("height",0).append("g").attr("transform","translate("+(radius+margin.left)+","+(radius+margin.top)+")"),d3.select("#header p").html(textintro),d3.select("#juhised p").html(juhised_intro)):(d3.select("svg").attr("width",svg_width).attr("height",svg_height).append("g").attr("transform","translate("+(radius+margin.left)+","+(radius+margin.top)+")"),"remove"==e?svg.selectAll("*").remove():create_figure(e))}function create_figure(e){function t(e){o.each(function(e){e.target=e.source=!1}),o.each(function(e){e.target2=e.source2=!1}),i.classed("link--target",function(t){return t.target===e?t.source.source=!0:void 0}).classed("link--source",function(t){return t.source===e?t.target.target=!0:void 0}).filter(function(t){return t.target===e||t.source===e}).each(function(){this.parentNode.appendChild(this)}),link2.classed("link--target2",function(t){return t.target2===e?t.source2.source2=!0:void 0}).classed("link--source2",function(t){return t.source2===e?t.target2.target2=!0:void 0}).filter(function(t){return t.target2===e||t.source2===e}).each(function(){this.parentNode.appendChild(this)}),o.classed("node--target",function(e){return e.target}).classed("node--source",function(e){return e.source}),o.classed("node--target2",function(e){return e.target2}).classed("node--source2",function(e){return e.source2})}function r(){i.classed("link--target",!1).classed("link--source",!1),link2.classed("link--target2",!1).classed("link--source2",!1),o.classed("node--target",!1).classed("node--source",!1),o.classed("node--target2",!1).classed("node--source2",!1)}function n(e){function t(e,n){var a,s=r[e];return s||(s=r[e]=n||{name:e,children:[]},e.length&&(s.parent=t(e.substring(0,a=e.lastIndexOf("_"))),s.parent.children.push(s),s.key=e.substring(a+1))),s}var r={};return e.forEach(function(e){var r=e.semester.concat("_",e.aine);t(r,e)}),r[""]}function a(e){var t={},r=[];return e.forEach(function(e){t[e.aine]=e}),e.forEach(function(e){e.eeldusained&&e.eeldusained.forEach(function(n){r.push({source:t[e.aine],target:t[n]})})}),r}function s(e){var t={},r=[];return e.forEach(function(e){t[e.aine]=e}),e.forEach(function(e){e.eeldusained2&&e.eeldusained2.forEach(function(n){r.push({source:t[e.aine],target:t[n]})})}),r}var i=svg.append("g").attr("id","seosed").selectAll(".link"),o=svg.append("g").attr("id","oppeained").selectAll(".node"),u=cluster.nodes(n(e)),d=a(u),c=s(u);link2=i.data(bundle(c)).enter().append("path").each(function(e){e.source2=e[0],e.target2=e[e.length-1]}).attr("class","link").style("stroke-dasharray","5, 5").attr("d",line),i=i.data(bundle(d)).enter().append("path").each(function(e){e.source=e[0],e.target=e[e.length-1]}).attr("class","link").attr("d",line),o=o.data(u.filter(function(e){return!e.children})).enter().append("text").attr("class","node").attr("dx",function(e){return e.x<180?8:-8}).attr("dy",".31em").attr("transform",function(e){return"rotate("+(e.x-90)+")translate("+e.y+")"+(e.x<180?"":"rotate(180)")}).style("text-anchor",function(e){return e.x<180?"start":"end"}).text(function(e){return e.key}).on("mouseover",t).on("mouseout",r),d3.select(self.frameElement).style("height",diameter+"px")}var diameter=600,radius=diameter/2,innerRadius=radius-120,margin={top:80,right:120,bottom:85,left:120},svg_width=diameter+margin.left+margin.right,svg_height=diameter+margin.top+margin.bottom,cluster=d3.layout.cluster().size([360,innerRadius]).sort(null).value(function(){return 1}),bundle=d3.layout.bundle(),line=d3.svg.line.radial().interpolate("bundle").tension(.8).radius(function(e){return e.y}).angle(function(e){return e.x/180*Math.PI}),svg=d3.select("#skeem").append("svg").attr("id","skeemi_ID").attr("width",10).attr("height",10).append("g").attr("transform","translate("+(radius+margin.left)+","+(radius+margin.top)+")");$("#filters a").click(function(){$("#filters a").removeClass("active"),$(this).addClass("active");$(this).attr("id")}),d3.select("#skeem").attr("align","center");